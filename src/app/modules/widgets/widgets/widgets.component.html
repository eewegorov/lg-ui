<div *ngIf="sites.length > 0" class="toolbar-content widgets-toolbar">
  <h1 class="title-main">{{ 'sidebar.widgets' | translate }}</h1>
  <div class="textcontent col-lg-12">
    <div class="select-site">
      <!-- Site selector -->
      <div class="selector">
        <div class="row select-site-title"><h5>{{ 'widgetsList.selectSite' | translate }}:</h5></div>
        <div class="row dropdown site-selector">
          <button aria-expanded="true" aria-haspopup="true" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                  type="button">
            <span class="dropdown-selected-cropp">{{ currentSite.name }}</span>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li (click)="changeCurrentSite(site)" *ngFor="let site of sites">
              <a class="dropdown-item">{{ site.name }}</a>
            </li>
          </ul>
        </div>
      </div>
      <!-- Company selector -->
      <div>
        <div class="row select-site-title"><h5>{{ 'widgetsList.selectCompany' | translate }}:</h5></div>
        <div class="row">
          <div *ngIf="!newCompany.on" class="d-flex">
            <div class="dropdown site-selector floated-left" style="min-width: 260px!important; width: 260px;">
              <button aria-expanded="true" aria-haspopup="true" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                      type="button">
                <span class="dropdown-selected-cropp"
                      style="max-width: 215px!important;">{{ currentCompany.name || defCompanyName }}</span>
                <span class="caret"></span>
              </button>
              <ul *ngIf="companies.length" class="dropdown-menu">
                <li (click)="changeCurrentCompany(company)" *ngFor="let company of companies">
                  <a class="dropdown-item">{{ company.name || defCompanyName }}</a>
                </li>
              </ul>
            </div>

            <button
              (click)="addNewCompany()"
              class="btn btn-default btn-inline ml-1"
              data-container="body"
              data-placement="top"
              data-title="{{ 'widgetsList.company.add.tooltip' | translate }}"
              data-toggle="tooltip"
            >
              <i class="fa fa-plus"></i>
            </button>
            <button
              (click)="deleteCompany()"
              *ngIf="!currentCompany.default"
              class="btn btn-default btn-inline ml-1"
              data-container="body"
              data-placement="top"
              data-title="{{ 'widgetsList.company.delete.tooltip' | translate }}"
              data-toggle="tooltip"
            >
              <i class="fa fa-trash"></i>
            </button>
          </div>
          <div *ngIf="newCompany.on" class="p-0 d-flex">
            <div [ngClass]="(newCompany.name.trim().length === 0) ? 'is-invalid' : ''" class="mr-2">
              <input
                [(ngModel)]="newCompany.name"
                class="form-control"
                placeholder="{{ 'widgetsList.clone.company.add.label' | translate }}"
                style="width: 245px;"
                type="text"
              >
            </div>
            <div class="mr-3">
              <button
                (click)="resetNewCompany()"
                class="btn btn-default btn-inline"
                data-container="body"
                data-placement="top"
                data-toggle="tooltip"
                title="{{ 'global.cancel' | translate }}"
              >
                <i class="fa fa-times"></i>
              </button>
              <button
                (click)="saveNewCompany()"
                [disabled]="newCompany.name.trim().length === 0"
                class="btn btn-success btn-inline ml-1"
                data-container="body"
                data-placement="top"
                data-toggle="tooltip"
                title="{{ 'widgetsList.company.add.tooltip' | translate }}"
              >
                <i class="fa fa-check"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="btnpanel padding-top-75">
      <div>
        <button
          (click)="createNewWidget()"
          class="btn btn-lg w-xs btn-success"
          type="button"
        ><i class="fa fa-plus-circle"></i> {{ 'widgetsList.add.title' | translate }}
        </button>
      </div>
      <div class="ng-binding" id="buyWidgetDevelopmentContainer"><a
        id="buyWidgetDevelopment">{{ 'widgetsList.add.alt' | translate }}</a></div>
    </div>
  </div>

</div>


<!-- smart points settings -->
<div *ngIf="sites.length > 0 && smartPoints" class="widgets-site-settings">
  <div class="row col-lg-12">
    <ui-switch
      (change)="enableDisableSP()"
      [(ngModel)]="smartPoints.enabled"
      class="mr-2"
    ></ui-switch>
    <h3 class="f-0">
      {{ 'widgetsList.site.default.title' | translate }} <a
      class="info-link" data-placement="bottom"
      data-toggle="tooltip"
      title="{{ 'widgetsList.site.default.tooltip' | translate }}"><i class="fa fa-info-circle"></i></a>
    </h3>
  </div>
  <div *ngIf="smartPoints.enabled" class="column ml-5 mr-5 pl-2 widget-page__smaptpoint-container">
    <span class="widget-page__smaptpoint-container-title">{{ 'settings.widgets.select' | translate }}:</span>
    <app-smartpoints-control [siteId]="currentSite.id" [smartPoints]="smartPoints"></app-smartpoints-control>
  </div>
</div>
<!-- End smart points settings -->


<div class="row col-lg-12 no-animate" id="myWidgets">
  <div *ngIf="isHasWidgets() || filteredContainers().length" class="col-lg-12 mt-3">
    <h3 class="f-0">{{ 'widgetsList.listTitle' | translate }}</h3>
  </div>
  <div *ngIf="!sites.length" class="col-lg-12 mt-3">
    <h3 class="f-0 text-center">{{ 'widgetsList.sitePlaceholder' | translate }}</h3>
    <h4 class="f-2 text-center underline-links blue-links hover-links">
      <span>{{ 'widgetsList.sitePlaceholder2' | translate }}</span>
      <a routerLink="/site/list">{{ 'widgetsList.sitePlaceholder3' | translate }}</a>
      <span>{{ 'widgetsList.sitePlaceholder4' | translate }}</span>
    </h4>
  </div>

  <!-- Static widgets -->
  <div *ngIf="containers.length && filteredContainers().length" class="col-lg-12 mt-3">
    <h4 class="f-1 no-bold">{{ 'containerized.title' | translate }}:</h4>
  </div>
  <div *ngIf="containers.length" style="width: 100%">
    <app-containerized-container
      *ngFor="let container of filteredContainers()"
      [container]="container"
      [currentCompany]="currentCompany"
      [site]="currentSite"
    ></app-containerized-container>
  </div>
  <!-- End Static widgets -->

  <div *ngIf="!isHasWidgets() && !filteredContainers().length && sites.length" class="col-lg-12 mt-3">
    <div *ngIf="currentCompany.default">
      <h3 class="f-0 text-center">{{ 'widgetsList.listPlaceholder' | translate }}</h3>
      <h4 class="f-2 text-center">{{ 'widgetsList.listPlaceholder2' | translate }}</h4>
    </div>
    <div *ngIf="!currentCompany.default">
      <h3 class="f-0 text-center">{{ 'widgetsList.listPlaceholder3' | translate }}</h3>
    </div>
  </div>

  <div *ngFor="let wdgTypes of getTypesWithCompanyFilter()" class="mt-3 col-lg-4 mw-100 mb-5">
    <h4 class="f-1 no-bold mt-3">{{ getTypeItem(wdgTypes)?.name }}:</h4>
    <div *ngFor="let widget of getFilteredWidgets(wdgTypes); index as i" class="row">
      <app-widget-item
        [first]="i === 0"
        [last]="i === getFilteredWidgets(wdgTypes).length - 1"
        [next]="getFilteredWidgets(wdgTypes)[i + 1]"
        [prev]="getFilteredWidgets(wdgTypes)[i - 1]"
        [widget]="widget">
      </app-widget-item>
    </div>
  </div>
</div>
