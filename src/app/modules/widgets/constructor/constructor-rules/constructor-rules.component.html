<div class="widgets-settings-container">
  <div class="settings-categories">
    <div
      *ngFor="let category of widgetSettingsCategories"
      class="settings-category"
      [ngClass]="{ 'active': currentCategory === category }"
      (click)="currentCategory = category"
    >
      <span>{{ category }}</span>
      <span
        *ngIf="isTabHasError(category) && showErrors" data-toggle="tooltip" data-placement="top"
        title="{{ 'widgetsList.editor.tab.errors.tooltip' | translate }}"
        class="info-link badge badge-pill badge-danger"
      ></span>
    </div>
  </div>
  <div class="settings-container">
    <div class="pb-5">
      <!-- Section Audience -->
      <div
        [hidden]="currentCategory !== widgetSettingsCategories[0]"
        id="audience"
      >
        <app-constructor-audiences
          [widget]="widget"
          [isMockup]="isMockup"
        ></app-constructor-audiences>
      </div>

      <!-- Section Targeting -->
      <div
        [hidden]="currentCategory !== widgetSettingsCategories[1]"
        id="targeting"
        class="d-flex"
      >
        <div class="col-lg-8">
          <h1>{{ 'widgetsList.editor.section.targeting' | translate }}</h1>

          <div class="rules-container">
            <!-- Page rule item -->
            <div class="border-item">
              <div
                class="d-flex justify-content-between align-items-center position-relative"
                [ngClass]="(widget.rules['pages'].enable && widget.rules['pages'].items.length > 0) ? 'mb-2' : 'rule-disabled'"
              >
                <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.rules.pageTargeting.name' | translate }} <a
                  data-toggle="tooltip" data-placement="top"
                  title="{{ 'widgetsList.editor.rules.pageTargeting.tooltip' | translate }}"
                  class="info-link"><i class="far fa-question-circle"></i></a>
                </h4>
                <ui-switch size="small" [(ngModel)]="widget.rules['pages'].enable"></ui-switch>
              </div>

              <ng-container *ngIf="widget.rules.pages?.enable">
                <div *ngFor="let item of widget.rules['pages'].items; index as i" class="d-flex align-items-center mt-2">
                  <div class="d-flex align-items-center">
                    <label class="control-label f-3">{{ 'widgetsList.editor.rules.widget' | translate }}</label>
                    <div class="dropdown ml-2">
                      <button class="d-flex btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
                              aria-expanded="true">
                        {{ getPageStateName(item) }}
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li role="presentation" (click)="item.state = 0">
                          <a role="menuitem" class="dropdown-item" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.hide' | translate }}
                          </a>
                        </li>
                        <li role="presentation" (click)="item.state = 1">
                          <a role="menuitem" class="dropdown-item" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.show' | translate }}
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="d-flex flex-shrink-0 align-items-center ml-2">
                    <label class="control-label f-3">{{ 'widgetsList.editor.rules.pageTargeting.pageInfo' | translate }}</label>
                    <div class="dropdown ml-2">
                      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                              aria-expanded="true">
                        {{ getPageCompareName(item) }}
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li role="presentation" (click)="item.compare = 0">
                          <a role="menuitem" class="dropdown-item" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.contain' | translate }}
                          </a>
                        </li>
                        <li role="presentation" class="dropdown-item" (click)="item.compare = 1">
                          <a role="menuitem" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.notcontain' | translate }}
                          </a>
                        </li>
                        <li role="presentation" class="dropdown-item" (click)="item.compare = 2">
                          <a role="menuitem" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.equals' | translate }}
                          </a>
                        </li>
                        <li role="presentation" class="dropdown-item" (click)="item.compare = 3">
                          <a role="menuitem" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.starts' | translate }}
                          </a>
                        </li>
                        <li role="presentation" class="dropdown-item" (click)="item.compare = 4">
                          <a role="menuitem" tabindex="-1" href="javascript:void(0)">
                            {{ 'widgetsList.editor.rules.pageTargeting.ends' | translate }}
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="d-flex align-items-center ml-2">
                    <div class="input-group" [ngClass]="(item.value.length == 0 && showErrors) ? 'is-invalid' : ''">
                      <div class="input-group-prepend">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                          {{ getPageTypeName(item) }} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                          <li role="presentation" class="dropdown-item" (click)="item.type = 0">
                            <a role="menuitem"
                               href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.url.title' | translate }}</a>
                          </li>
                          <li role="presentation" class="dropdown-item" (click)="item.type = 1">
                            <a role="menuitem"
                               href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.title' | translate }}</a>
                          </li>
                        </ul>
                      </div>
                      <input type="text" class="form-control" [(ngModel)]="item.value">
                    </div>
                    <div *ngIf="widget.rules['pages'].items.length > 1" class="remove-sub-item">
                      <button class="delete-element-button" (click)="removePageRuleItem(i)">&times;</button>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <button class="btn-default widget-content-add-btn" (click)="addPageRuleItem()">
                    <img src="assets/images/widgets/plus.svg" alt="add element" /> Добавить страницу
                  </button>
                </div>
              </ng-container>
            </div>
            <!-- END Page rule item -->

            <!-- Target to viewed pages -->
            <div class="border-item mt-3">
              <div
                class="d-flex justify-content-between align-items-center position-relative"
                [ngClass]="(widget.rules['prevPages']?.enable && widget.rules['prevPages']?.items.length > 0) ? 'mb-2' : 'rule-disabled'"
              >
                <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.rules.pageVTargeting.title' | translate }}
                  <span
                    class="label label-warning tariff-info ">окупаемый</span> <a
                    data-toggle="tooltip" data-placement="top"
                    title="{{ 'widgetsList.editor.rules.pageVTargeting.tooltip' | translate }}"
                    class="info-link"><i class="far fa-question-circle"></i></a>
                </h4>

                <ui-switch size="small" [(ngModel)]="widget.rules['prevPages'].enable"
                           (change)="onChangePayment"></ui-switch>
              </div>

              <ng-container *ngIf="widget.rules['prevPages']?.enable">
                <div *ngFor="let item of widget.rules['prevPages'].items; index as i"
                     class="d-flex align-items-center mt-2">
                  <div class="d-flex align-items-center">
                    <div class="dropdown">
                      <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
                              aria-expanded="true">
                        {{ getPageCompareName(item) }}
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li role="presentation" (click)="item.compare = 0">
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.contain' | translate }}</a>
                        </li>
                        <li role="presentation" (click)="item.compare = 1">
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.notcontain' | translate }}</a>
                        </li>
                        <li role="presentation" (click)="item.compare = 2">
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.equals' | translate }}</a>
                        </li>
                        <li role="presentation" (click)="item.compare = 3">
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.starts' | translate }}</a>
                        </li>
                        <li role="presentation" (click)="item.compare = 4">
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.ends' | translate }}</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="d-flex align-items-center flex-grow-1 ml-2">
                    <div class="input-group" [ngClass]="(item.value.length == 0 && showErrors) ? 'is-invalid' : ''">
                      <div class="input-group-prepend">
                        <button
                          type="button"
                          class="btn btn-default dropdown-toggle"
                          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                        >
                          {{ getPageTypeName(item) }} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                          <li role="presentation" (click)="item.type = 0">
                            <a role="menuitem" class="dropdown-item"
                               href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.url.title' | translate }}</a>
                          </li>
                          <li role="presentation" (click)="item.type = 1">
                            <a role="menuitem" class="dropdown-item"
                               href="javascript:void(0)">{{ 'widgetsList.editor.rules.pageTargeting.title' | translate }}</a>
                          </li>
                        </ul>
                      </div>
                      <input type="text" class="form-control" [(ngModel)]="item.value">
                    </div>
                    <div *ngIf="widget.rules['prevPages'].items.length > 1" class="remove-sub-item">
                      <button class="delete-element-button" (click)="removePrevPageRuleItem(i)">&times;</button>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <button class="btn-default widget-content-add-btn" (click)="addPrevPageRuleItem()">
                    <img src="assets/images/widgets/plus.svg" alt="add element" /> Добавить страницу
                  </button>
                </div>
              </ng-container>
            </div>
            <!-- END Target to viewed pages -->

            <!-- PageNo rule -->
            <div class="border-item mt-3">
              <div
                class="d-flex justify-content-between align-items-center position-relative"
                [ngClass]="widget.rules['pageNo']?.enable ? 'mb-2' : 'rule-disabled'"
              >
                <h4 class="widgets-settings-subtitle">
                  {{ 'widgetsList.editor.rules.pageNo.title' | translate }} <span class="label label-warning tariff-info">окупаемый</span>
                  <a
                    data-toggle="tooltip" data-placement="top"
                    title="{{ 'widgetsList.editor.rules.pageNo.select.title' | translate }}"
                    class="info-link"><i class="far fa-question-circle"></i></a>
                </h4>

                <ui-switch size="small" [(ngModel)]="widget.rules.pageNo.enable" (change)="onChangePayment"></ui-switch>
              </div>

              <div
                *ngIf="widget.rules.pageNo?.enable"
                [ngClass]="(widget.rules.pageNo.items.length > 0 || !showErrors) ? '' : 'is-invalid'"
              >
                <ng-select
                  id="widgetSelector"
                  bindValue="current"
                  bindLabel="current"
                  multiple="true"
                  appendTo="body"
                  [items]="loop"
                  [placeholder]="'widgetsList.editor.rules.pageNo.select.placeholder' | translate"
                  [(ngModel)]="widget.rules.pageNo.items"
                ></ng-select>
              </div>
            </div>
            <!-- End Page No rule -->

            <!-- Time options start -->
            <div class="border-item mt-3">
              <div
                class="d-flex justify-content-between align-items-center position-relative"
                [ngClass]="(widget.rules.time.enable && widget.rules['time'].items.length > 0) ? 'mb-2' : 'rule-disabled'"
              >
                <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.rules.dateTime.title' | translate }} <span
                  class="label label-warning tariff-info">окупаемый</span> <a
                  data-toggle="tooltip" data-placement="top"
                  title="{{ 'widgetsList.editor.rules.dateTime.placeholder' | translate }}"
                  class="info-link"><i class="far fa-question-circle"></i></a>
                </h4>

                <ui-switch size="small" [(ngModel)]="widget.rules.time.enable" (change)="onChangePayment"></ui-switch>
              </div>

              <ng-container *ngIf="widget.rules['time'].enable">
                <div *ngFor="let item of widget.rules['time'].items; index as i" class="d-flex align-items-center mt-2">
                  <div class="d-flex align-items-center pt-1">
                    <div class="f-2">
                      {{ 'widgetsList.editor.rules.time.from' | translate }}
                    </div>
                    <div class="dropdown ml-2" style="float: left;">
                      <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
                              aria-expanded="true">
                        {{ getStringFromTime(item.startTime) }}
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu" style="max-height: 150px; overflow: auto;">
                        <li role="presentation" *ngFor="let timeItem of getTimeList()"
                            (click)="item.startTime = timeItem.value">
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ timeItem.name }}</a>
                        </li>
                      </ul>
                    </div>
                    <div class="ml-3 f-2">
                      {{ 'widgetsList.editor.rules.time.to' | translate }}
                    </div>
                    <div class="dropdown ml-2" style="float: left;">
                      <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
                              aria-expanded="true">
                        {{ getStringFromTime(item.endTime) }}
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu" style="max-height: 150px; overflow: auto;">
                        <li
                          role="presentation"
                          *ngFor="let timeItem of getTimeList()"
                          (click)="item.endTime = timeItem.value"
                        >
                          <a role="menuitem" class="dropdown-item" tabindex="-1"
                             href="javascript:void(0)">{{ timeItem.name }}</a>
                        </li>
                      </ul>
                    </div>
                    <div *ngIf="widget.rules['time'].items.length > 1" class="remove-sub-item">
                      <button class="delete-element-button" (click)="removeTimeRuleItem(i)">&times;</button>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <button class="btn-default widget-content-add-btn" (click)="addTimeRuleItem()">
                    <img src="assets/images/widgets/plus.svg" alt="add element" /> Добавить период
                  </button>
                </div>
              </ng-container>
            </div>
            <!-- End Time options -->

            <!-- Days options start -->
            <div class="border-item mt-3">
              <div
                class="d-flex justify-content-between align-items-center position-relative"
                [ngClass]="widget.rules.days.enable ? 'mb-2' : 'rule-disabled'"
              >
                <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.rules.days.header' | translate }} <span
                  class="label label-warning tariff-info">окупаемый</span> <a
                  data-toggle="tooltip" data-placement="top"
                  title="{{ 'widgetsList.editor.rules.days.title' | translate }}"
                  class="info-link"><i class="far fa-question-circle"></i></a>
                </h4>

                <ui-switch size="small" [(ngModel)]="widget.rules.days.enable" (change)="onChangePayment"></ui-switch>
              </div>

              <div
                *ngIf="widget.rules.days?.enable"
                [ngClass]="(widget.rules.days.items.length > 0 || !showErrors) ? '' : 'is-invalid'"
              >
                <ng-select
                  id="daysSelector"
                  bindValue="id"
                  bindLabel="name"
                  multiple="true"
                  appendTo="body"
                  clearable="true"
                  [items]="weekDays"
                  [placeholder]="'widgetsList.editor.rules.days.select.placeholder' | translate"
                  [(ngModel)]="widget.rules.days.items"
                ></ng-select>
              </div>
            </div>
            <!-- End days options-->

            <!-- Date range -->
            <div class="mt-3 mb-3">
              <div
                class="d-flex justify-content-between align-items-center position-relative"
                [ngClass]="widget.rules.period.enable ? 'mb-2' : 'rule-disabled'"
              >
                <h4 class="widgets-settings-subtitle">
                  {{ 'widgetsList.editor.rules.period.header' | translate }} <span
                  class="label label-warning tariff-info">окупаемый</span> <a
                  data-toggle="tooltip" data-placement="top"
                  title="{{ 'widgetsList.editor.rules.period.tooltip' | translate }}"
                  class="info-link"><i class="far fa-question-circle"></i></a>
                </h4>

                <ui-switch size="small" [(ngModel)]="widget.rules.period.enable" (change)="onChangePayment"></ui-switch>
              </div>

              <div *ngIf="widget.rules.period?.enable" class="d-flex align-items-center">
                <div class="f-2">
                  {{ 'widgetsList.editor.rules.time.from' | translate }}
                </div>
                <div id="period-rule-start-date-picker" class="datepicker ml-2">
                  <ngbd-datepicker-i18n [(ngModel)]="widget.rules.period.startDate"></ngbd-datepicker-i18n>
                </div>
                <div class="f-2 ml-3">
                  {{ 'widgetsList.editor.rules.time.to' | translate }}
                </div>
                <div id="period-rule-end-date-picker" class="datepicker ml-2">
                  <ngbd-datepicker-i18n [(ngModel)]="widget.rules.period.endDate"></ngbd-datepicker-i18n>
                </div>
              </div>
            </div>
            <!-- End Date range -->
          </div>
        </div>

        <div class="col-lg-4">
          <p class="mt-5 pt-2">Таргетинг позволяет настроить страницы на которых будет отображаться виджет.</p>
        </div>
      </div>

      <div [hidden]="isContainerized">
        <!-- Section Autoinvite -->
        <div
          [hidden]="currentCategory !== widgetSettingsCategories[2]"
          id="autoinvite"
          class="d-flex"
        >
          <div class="col-lg-8">
            <h1>{{ 'widgetsList.editor.autoinvite.title' | translate }} <a
              data-toggle="tooltip" data-placement="top"
              title="{{ 'widgetsList.editor.autoinvite.tooltip' | translate }}"
              class="info-link ml-1"><i class="fa fa-info-circle"></i></a>
            </h1>

            <div class="rules-container">
              <div class="d-flex flex-wrap border-item mt-3">
                <label class="control-label control-label-des">
                  {{ 'widgetsList.editor.autoinvite.variants.title1' | translate }}
                </label>
                <div class="dropdown">
                  <button class="btn btn-default dropdown-toggle round-button" type="button" data-toggle="dropdown"
                          aria-expanded="true">
                    {{ widget.autoinvite.ruleLogic }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li
                      role="presentation"
                      *ngFor="let itemLogic of autoinviteVariants"
                      (click)="widget.autoinvite.ruleLogic = itemLogic"
                    >
                      <a role="menuitem" class="dropdown-item" tabindex="-1" href="javascript:void(0)">{{ itemLogic }}</a>
                    </li>
                  </ul>
                </div>
                <label class="control-label control-label-des">
                  {{ 'widgetsList.editor.autoinvite.variants.title2' | translate }}
                </label>
              </div>

              <!-- Autoinvite: pages -->
              <div class="border-item mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div
                    class="d-flex justify-content-between align-items-center"
                    [class.rule-disabled]="!widget.autoinvite.pages.enable"
                  >
                    <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.autoinvite.pages.enable' | translate }}</h4>
                    <div
                      class="d-flex"
                      [class.is-invalid]="widget.autoinvite.pages.value <= 0 && showErrors"
                    >
                      <input
                        style="float: left; width: 70px;"
                        class="form-control"
                        type="number"
                        min="1"
                        [(ngModel)]="widget.autoinvite.pages.value"
                        [disabled]="!widget.autoinvite.pages.enable"
                      />
                    </div>
                    <h4 class="widgets-settings-subtitle ml-2">
                      {{ 'widgetsList.editor.autoinvite.pages.suffix' | translate }}
                      <span class="label label-warning tariff-info ml-2">окупаемый</span>
                    </h4>
                  </div>

                  <ui-switch size="small" [(ngModel)]="widget.autoinvite.pages.enable"
                             (change)="onChangePayment"></ui-switch>
                </div>
              </div>
              <!-- END Autoinvite pages -->

              <!-- Autoinvite: seconds -->
              <div class="border-item mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div
                    class="d-flex justify-content-between align-items-center"
                    [class.rule-disabled]="!widget.autoinvite.seconds.enable"
                  >
                    <h4 class="widgets-settings-subtitle">
                      {{ 'widgetsList.editor.autoinvite.seconds.enable' | translate }}
                    </h4>
                    <div
                      class="d-flex"
                      [class.is-invalid]="widget.autoinvite.seconds.value <= 0 && showErrors"
                    >
                      <input
                        style="float: left; width: 70px;"
                        class="form-control"
                        type="number"
                        min="1"
                        [(ngModel)]="widget.autoinvite.seconds.value"
                        [disabled]="!widget.autoinvite.seconds.enable"
                      />
                    </div>
                    <h4 class="widgets-settings-subtitle ml-2">
                      {{ 'widgetsList.editor.autoinvite.seconds.suffix' | translate }}
                    </h4>
                  </div>

                  <ui-switch size="small" [(ngModel)]="widget.autoinvite.seconds.enable"></ui-switch>
                </div>
              </div>
              <!-- End Autoinvite seconds -->

              <!-- Autoinvite: inactive -->
              <div class="border-item mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div
                    class="d-flex justify-content-between align-items-center"
                    [class.rule-disabled]="!widget.autoinvite.inactive.enabled"
                  >
                    <h4 class="widgets-settings-subtitle">
                      {{ 'widgetsList.editor.autoinvite.inactive.enabled' | translate }}
                    </h4>
                    <div
                      class="d-flex mt-1"
                      [class.is-invalid]="widget.autoinvite.inactive.value <= 0 && showErrors"
                    >
                      <input
                        style="float: left; width: 70px;"
                        class="form-control"
                        type="number"
                        min="1"
                        [(ngModel)]="widget.autoinvite.inactive.value"
                        [disabled]="!widget.autoinvite.inactive.enabled"
                      />
                    </div>
                    <h4 class="widgets-settings-subtitle ml-2">
                      {{ 'widgetsList.editor.autoinvite.inactive.suffix' | translate }}
                      <span class="label label-warning tariff-info ml-2">окупаемый</span>
                    </h4>
                  </div>

                  <ui-switch size="small" [(ngModel)]="widget.autoinvite.inactive.enabled"
                             (change)="onChangePayment"></ui-switch>
                </div>
              </div>
              <!-- End Autoinvite: inactive -->

              <!-- Autoinvite: percent -->
              <div class="border-item mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div
                    class="d-flex justify-content-between align-items-center"
                    [class.rule-disabled]="!widget.autoinvite.percent.enable"
                  >
                    <h4 class="widgets-settings-subtitle">
                      {{ 'widgetsList.editor.autoinvite.percent.enable' | translate }}
                    </h4>
                    <div
                      class="d-flex mt-1"
                      [class.is-invalid]="widget.autoinvite.percent.value <= 0 && showErrors"
                    >
                      <input
                        style="float: left; width: 70px;"
                        class="form-control"
                        type="number"
                        min="1"
                        max="100"
                        [(ngModel)]="widget.autoinvite.percent.value"
                        [disabled]="!widget.autoinvite.percent.enable"
                      />
                    </div>
                    <h4 class="widgets-settings-subtitle ml-2">
                      {{ 'widgetsList.editor.autoinvite.percent.suffix' | translate }}
                      <span class="label label-warning tariff-info ml-2">окупаемый</span>
                    </h4>
                  </div>

                  <ui-switch size="small" [(ngModel)]="widget.autoinvite.percent.enable"
                             (change)="onChangePayment"></ui-switch>
                </div>
              </div>
              <!-- End Autoinvite: percent -->

              <!-- Autoinvite: click -->
              <div class="border-item mt-3" [class.rule-disabled]="!widget.autoinvite.click.enable">
                <div class="d-flex justify-content-between align-items-center">
                  <h4 class="widgets-settings-subtitle">
                    {{ 'widgetsList.editor.autoinvite.click.enable' | translate }}
                  </h4>

                  <ui-switch size="small" [(ngModel)]="widget.autoinvite.click.enable"></ui-switch>
                </div>

                <div
                  class="d-flex flex-column pt-2"
                  [class.is-invalid]="widget.autoinvite.click.value.trim().length == 0 && showErrors"
                >
                  <label class="control-label extra-header">
                    {{ 'widgetsList.editor.autoinvite.click.title' | translate }}
                  </label>
                  <input
                    class="form-control extra-header"
                    type="text"
                    [(ngModel)]="widget.autoinvite.click.value"
                    [disabled]="!widget.autoinvite.click.enable"
                  />
                  <div class="row small mt-1 underline-comment">
                    <span [innerHTML]="'widgetsList.editor.autoinvite.click.comment' | translate"></span>
                  </div>
                </div>
              </div>
              <!-- End Autoinvite seconds -->

              <!-- Autoinvite: exit-intent -->
              <div class="border-item mt-3" [class.rule-disabled]="!widget.autoinvite.exit.enable">
                <div class="d-flex justify-content-between align-items-center">
                  <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.autoinvite.exit.enable' | translate }}</h4>

                  <ui-switch size="small" [(ngModel)]="widget.autoinvite.exit.enable" (valueChange)="changeExitIntent($event)"></ui-switch>
                </div>

                <div class="mt-2 d-flex">
                  <div class="form-check mt-1">
                    <label class="form-check-label">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        [(ngModel)]="widget.autoinvite.exit.desktopEnable"
                        [disabled]="!widget.autoinvite.exit.enable"
                      />
                      <span class="checkmark"></span>
                    </label>
                  </div>
                  <h5 class="control-label switcher-label switcher-label-xs">
                    {{ 'widgets.settings.exitIntent.desktop' | translate }}
                  </h5>
                </div>
                <div class="mt-2 d-flex">
                  <div class="form-check mt-1">
                    <label class="form-check-label">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        [(ngModel)]="widget.autoinvite.exit.mobileEnable"
                        [disabled]="!widget.autoinvite.exit.enable"
                      />
                      <span class="checkmark"></span>
                    </label>
                  </div>
                  <h5 class="control-label switcher-label switcher-label-xs">
                    {{ 'widgets.settings.exitIntent.mobile' | translate }}
                  </h5>
                </div>
              </div>
              <!-- End Autoinvite: exit-intent -->

              <!-- Autoinvite: sound -->
              <div class="d-flex mt-4 mb-3">
                <div class="form-check">
                  <label class="form-check-label">
                    <input
                      type="checkbox"
                      [(ngModel)]="widget.autoinvite.sound.enable"
                      class="form-check-input"
                    />
                    <span class="checkmark"></span>
                  </label>
                </div>
                <h4 class="widgets-settings-subtitle mt-0 ml-1">
                  {{ 'widgetsList.editor.autoinvite.sound.enable' | translate }}
                </h4>
              </div>
              <!-- End Autoinvite: sound -->
            </div>
          </div>
          <div class="col-lg-4">
            <p class="mt-5 pt-2">
              Виджет будет показан посетителю автоматически, в зависимости от того, какие правила вы
              активируете и какую логику взаимодействия между ними вы выберете.
            </p>
          </div>
        </div>

        <!-- Section Restrictions -->
        <div
          [hidden]="currentCategory !== widgetSettingsCategories[3]"
          id="restrictions"
          class="col-lg-8"
        >
          <h1>{{ 'widgetsList.editor.section.block' | translate }}</h1>

          <div class="rules-container">
            <h4 class="widgets-settings-subtitle mt-3">
              {{ 'widgetsList.editor.restrictions.title' | translate }} <span
              class="label label-warning tariff-info ml-2">окупаемый</span>
            </h4>

            <div class="d-flex mt-4">
              <input
                type="radio"
                class="radio-left mt-0"
                name="restrictions"
                [value]="1"
                [(ngModel)]="widget.restrictions.target.mode"
                (ngModelChange)="onRestrictionModeChange()"
              >
              <label class="control-label switcher-label ml-1">
                {{ 'widgetsList.editor.restrictions.disable.title' | translate }}
              </label>
            </div>
            <div class="d-flex mt-3">
              <input
                type="radio"
                class="radio-left mt-0"
                name="restrictions"
                [value]="2"
                [(ngModel)]="widget.restrictions.target.mode"
                (ngModelChange)="onRestrictionModeChange()"
              >
              <label class="control-label switcher-label ml-1">
                {{ 'widgetsList.editor.restrictions.enable.title' | translate }}
              </label>
            </div>
            <div class="border-item">
              <div class="d-flex mt-3">
                <input
                  type="radio"
                  class="radio-left mt-0"
                  name="restrictions"
                  [value]="0"
                  [(ngModel)]="widget.restrictions.target.mode"
                >
                <label class="control-label switcher-label ml-1">
                  {{ 'widgetsList.editor.restrictions.ontime.title' | translate }}
                </label>
              </div>

              <div class="d-flex align-items-center mt-2" *ngIf="widget.restrictions.target?.mode == 0">
                <div class="f-3">
                  {{ 'widgetsList.editor.restrictions.disable.label' | translate }}
                </div>
                <div class="dropdown ml-2" style="float: left;">
                  <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
                          aria-expanded="true">
                    {{ widget.restrictions.target.gap }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" style="max-height: 150px; overflow: auto;">
                    <li
                      role="presentation"
                      *ngFor="let timeItem of restrictionsGaps"
                      (click)="widget.restrictions.target.gap = timeItem"
                    ><a role="menuitem" class="dropdown-item" tabindex="-1" href="javascript:void(0)">{{ timeItem }}</a>
                    </li>
                  </ul>
                </div>
                <div class="f-3 ml-2">
                  {{ 'widgetsList.editor.restrictions.hours' | translate }}
                </div>
              </div>
            </div>

            <div class="mt-3">
              <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.restrictions.title2' | translate }} <a
                data-toggle="tooltip" data-placement="top"
                title="{{ 'widgetsList.editor.restrictions.autoinvite.tooltip' | translate }}"
                class="info-link"><i class="far fa-question-circle"></i></a></h4>
            </div>
            <!-- Restrictions.autoinvite -->
            <div class="d-flex mt-4">
              <div class="form-check">
                <label class="form-check-label">
                  <input
                    type="checkbox"
                    id="autoinviteEnable"
                    name="autoinviteEnable"
                    [(ngModel)]="widget.restrictions.autoinvite.enable"
                    class="form-check-input"
                  />
                  <span class="checkmark"></span>
                </label>
              </div>
              <label class="control-label switcher-label">
                {{ 'widgetsList.editor.restrictions.autoinvite.text' | translate }}<br/>
              </label>
            </div>
            <div *ngIf="widget.restrictions.autoinvite?.enable" class="d-flex align-items-center mt-2 ml-4 pl-1">
              <div class="f-3">
                {{ 'widgetsList.editor.restrictions.disable.label' | translate }}
              </div>
              <input class="form-control widgets-num-input ml-2" type="number" min="0" max="72"
                     [(ngModel)]="widget.restrictions.autoinvite.gap"/>
              <div class="f-3 ml-2">
                {{ 'widgetsList.editor.restrictions.hours' | translate }}
              </div>
            </div>
            <!-- End restrictions.autoinvite -->

            <!-- Restrictions.unique -->
            <div *ngIf="widget.restrictions.unique" class="d-flex mt-4">
              <div class="form-check">
                <label class="form-check-label">
                  <input
                    type="checkbox"
                    id="uniqueEnable"
                    name="uniqueEnable"
                    [(ngModel)]="widget.restrictions.unique.enable"
                    class="form-check-input"
                  />
                  <span class="checkmark"></span>
                </label>
              </div>
              <label class="control-label switcher-label">
                {{ 'widgetsList.editor.restrictions.unique.text' | translate }}<br/>
              </label>
            </div>
            <div *ngIf="widget.restrictions.unique?.enable" class="d-flex align-items-center mt-2 ml-4 pl-1">
              <div class="f-3">
                {{ 'widgetsList.editor.restrictions.disable.label' | translate }}
              </div>
              <input class="form-control widgets-num-input ml-2" type="number" min="0"
                     [(ngModel)]="widget.restrictions.unique.gap"/>
              <div class="f-3 ml-2">
                {{ 'widgetsList.editor.restrictions.hours' | translate }}
              </div>
            </div>
            <!-- END Restrictions.unique -->

            <!-- Restrictions.lockAfterAction -->
            <div *ngIf="widget.restrictions.action" class="d-flex mt-4">
              <div class="form-check">
                <label class="form-check-label">
                  <input
                    #actionEnable
                    type="checkbox"
                    id="actionEnable"
                    name="actionEnable"
                    [(ngModel)]="widget.restrictions.action.enable"
                    (change)="onChangePayment(actionEnable.checked)"
                    class="form-check-input"
                  />
                  <span class="checkmark"></span>
                </label>
              </div>
              <label class="control-label switcher-label">
                {{ 'widgets.settings.lockAfterAction.title' | translate }}<span class="label label-warning tariff-info ml-2">окупаемый</span><br/>
              </label>
            </div>
            <div *ngIf="widget.restrictions?.action?.enable" class="d-flex align-items-center mt-2 ml-4 pl-1">
              <div class="f-3">
                {{ 'widgets.settings.lockAfterAction.lock1' | translate }}
              </div>
              <input class="form-control widgets-num-input ml-2" type="number" min="0"
                     [(ngModel)]="widget.restrictions.action.gap"/>
              <div class="f-3 ml-2">
                {{ 'widgets.settings.lockAfterAction.lock2' | translate }}
              </div>
            </div>
            <!-- END Restrictions.lockAfterAction -->

            <!-- Restrictions.count -->
            <div *ngIf="widget.restrictions.count" class="d-flex mt-4">
              <div class="form-check">
                <label class="form-check-label">
                  <input
                    #countEnable
                    type="checkbox"
                    id="countEnable"
                    name="countEnable"
                    [(ngModel)]="widget.restrictions.count.enable"
                    (change)="onChangePayment(countEnable.checked)"
                    class="form-check-input"
                  />
                  <span class="checkmark"></span>
                </label>
              </div>
              <label class="control-label switcher-label">
                {{ 'widgetsList.editor.restrictions.count.text' | translate }} <span
                class="label label-warning tariff-info ml-2">окупаемый</span><br/>
              </label>
            </div>
            <div *ngIf="widget.restrictions.count?.enable" class="ml-4 pl-1">
              <div class="d-flex align-items-center mt-2">
                <div class="f-3">
                  {{ 'widgetsList.editor.restrictions.count.part1' | translate }}
                </div>
                <input class="form-control widgets-num-input ml-2" type="number" min="0"
                       [(ngModel)]="widget.restrictions.count.count"/>
                <div class="f-3 ml-2">
                  {{ 'widgetsList.editor.restrictions.count.part2' | translate }}
                </div>
              </div>
              <div class="d-flex align-items-center mt-2">
                <div class="f-3">
                  {{ 'widgetsList.editor.restrictions.count.part3' | translate }}
                </div>
                <input class="form-control widgets-num-input ml-2" type="number" min="0"
                       [(ngModel)]="widget.restrictions.count.interval"/>
                <div class="dropdown ml-1" style="display: inline;">
                  <button class="btn btn-default dropdown-toggle f-3" type="button" data-toggle="dropdown"
                          aria-expanded="true">
                    {{ units[widget.restrictions.count.unit] }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li
                      role="presentation"
                      *ngFor="let key of getUnitsKeys()"
                      (click)="widget.restrictions.count.unit = key"
                    >
                      <a role="menuitem" class="dropdown-item" tabindex="-1"
                         href="javascript:void(0)">{{ units[key] }}</a>
                    </li>
                  </ul>
                </div>
                <div class="f-3 ml-2">
                  {{ 'widgetsList.editor.restrictions.count.part4' | translate }}
                </div>
              </div>
              <!-- END Restrictions.count -->
            </div>
          </div>
        </div>
      </div>

      <!-- Section Autoresponder -->
      <div
        [hidden]="(!isContainerized && (currentCategory !== widgetSettingsCategories[4])) || (isContainerized && (currentCategory !== widgetSettingsCategories[2]))"
        id="autoresponder"
        class="d-flex"
      >
        <div class="col-lg-8">
          <h1>{{ 'widgetsList.editor.section.autoresponder' | translate }} <a
            data-toggle="tooltip" data-placement="top"
            title="{{ 'widgetsList.editor.autoresponder.tooltip' | translate }}"
            class="info-link"><i class="fa fa-info-circle"></i></a>
          </h1>

          <div class="d-flex justify-content-between align-items-center mt-3 pt-1">
            <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.section.autoresponder' | translate }}</h4>
            <ui-switch size="small" [(ngModel)]="widget.autoresponder.enabled"></ui-switch>
          </div>

          <div *ngIf="widget.autoresponder?.enabled" class="mt-1 mb-1">
            <div
              class="audience-tooolbar-desc underline-links blue-links hover-links"
              [innerHTML]="'widgets.coupon.autoresponder' | translate"
            ></div>
          </div>
          <div
            *ngIf="widget.autoresponder?.enabled"
            class="mt-3"
            [ngClass]="(widget.autoresponder.subject?.toString().trim().length < 1 && showErrors) ? 'is-invalid' : ''"
          >
            <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.autoresponder.subject' | translate }}</h4>
            <input class="form-control" [(ngModel)]="widget.autoresponder.subject">
          </div>
          <div
            *ngIf="widget.autoresponder?.enabled"
            class="mt-3"
            [ngClass]="(widget.autoresponder.text?.toString().trim().length < 1 && showErrors) ? 'is-invalid' : ''"
          >
            <h4 class="widgets-settings-subtitle">{{ 'widgetsList.editor.autoresponder.text' | translate }}</h4>
            <angular-editor class="d-flex" placeholder="" [(ngModel)]="widget.autoresponder.text"></angular-editor>
          </div>
        </div>
        <div class="col-lg-4">
          <p class="mt-5 pt-1">
            Вы можете настроить автоматическое письмо посетителю, отсылаемое после отправки формы в виджете.
            Например, это может быть ссылка на электронную книгу, благодарственное письмо или коммерческое предложение.
          </p>
        </div>
      </div>
      <!-- End autoresponder -->

      <!-- Section JS Code Actions -->
      <div
        [hidden]="(!isContainerized && (currentCategory !== widgetSettingsCategories[5])) || (isContainerized && (currentCategory !== widgetSettingsCategories[3]))"
        id="javascript"
        class="d-flex"
      >
        <div class="col-lg-8">
          <h1>{{ 'widgets.settings.jscode.title' | translate }}</h1>

          <div class="d-flex justify-content-between align-items-center mt-3 pt-1">
            <h4 class="widgets-settings-subtitle">{{ 'widgets.settings.jscode.onShowChecker' | translate }}</h4>
            <ui-switch size="small" [(ngModel)]="widget.jsInfo.onShowScript.enable"></ui-switch>
          </div>

          <div *ngIf="widget.jsInfo.onShowScript.enable" class="d-flex mt-2">
            <textarea
              class="form-control textar-iframe cons-settings-js-textarea"
              [(ngModel)]="widget.jsInfo.onShowScript.script"
            ></textarea>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-3 pt-1">
            <h4 class="widgets-settings-subtitle">{{ 'widgets.settings.jscode.onActionChecker' | translate }}</h4>
            <ui-switch size="small" [(ngModel)]="widget.jsInfo.onTargetScript.enable"></ui-switch>
          </div>

          <div *ngIf="widget.jsInfo.onTargetScript.enable" class="d-flex flex-column mt-2">
            <div class="d-flex">
              <textarea
                class="form-control textar-iframe cons-settings-js-textarea"
                [(ngModel)]="widget.jsInfo.onTargetScript.script"
              ></textarea>
            </div>
            <div class="d-flex mt-3 pt-2">
              <div class="form-check">
                <label class="form-check-label">
                  <input
                    #enablePlaceholding
                    type="checkbox"
                    id="enablePlaceholding"
                    name="enablePlaceholding"
                    [(ngModel)]="widget.jsInfo.enablePlaceholding"
                    (change)="onChangePayment(enablePlaceholding.checked)"
                    class="form-check-input"
                  />
                  <span class="checkmark"></span>
                </label>
              </div>
              <label class="control-label switcher-label">
                {{ 'widgets.settings.jscode.autochange' | translate }} <span class="label label-warning tariff-info ml-2">окупаемый</span>
              </label>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="mt-5 pt-1">
            Javascript код может быть выполнен как при показе виджета, так и при совершении целевого действия в нем
            (отправка формы, шеринг или клик). Вы можете активировать поддержку автоматической подстановки значений
            полей формы в Javascript код, выполняемый при совершении целевого действия, для этого используйте id поля,
            заключив его в фигурные скобки:
          </div>
          <div>&#123;__email__&#125; — емейл;</div>
          <div>&#123;__name__&#125; — имя;</div>
          <div>&#123;__phone__&#125; — телефон;</div>
          <p>&#123;__message__&#125; — сообщение.</p>
          <p>И активируйте поддержку подстановки.</p>
        </div>
      </div>
      <!-- END JS Code Actions -->

      <!-- Section Integrations -->
      <div
        [hidden]="(!isContainerized && (currentCategory !== widgetSettingsCategories[6])) || (isContainerized && (currentCategory !== widgetSettingsCategories[4]))"
        id="integrations"
      >
        <app-constructor-integrations
          [sid]="sid"
          [widget]="widget"
        ></app-constructor-integrations>
      </div>

    </div>
  </div>
</div>
