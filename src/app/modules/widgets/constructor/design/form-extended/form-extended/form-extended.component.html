<div *ngIf="widget">
  <ul
    *ngIf="widget.guiprops?.formExt?.model"
    class="form-ext-wrapper"
    [sortablejs]="widget.guiprops.formExt.model.list"
    [sortablejsOptions]="onDrDr"
  >
    <li class="form-ext-item"
        *ngFor="let extItem of widget.guiprops.formExt.model.list; index as innerIndex"
        [ngClass]="dragItemClass(extItem)"
        (click)="toggleItem($event, innerIndex, true)"
        (mouseover)="highlightContentOn(innerIndex, extItem.type)"
        (mouseleave)="highlightContentOff(innerIndex)"
        [attr.data-to-ext]="innerIndex">
      <div class="form-ext-item__header">
        <div class="form-ext-item__header-l grab-form-ext-item">
          <i class="fa fa-bars"></i>
        </div>
        <div class="form-ext-item__header-r">
          <div
            *ngIf="!((innerIndex === 0) && (widget.guiprops.formExt.model.list.length === 1))"
            class="form-ext-item__header-delete"
            (click)="removeElementFromFormExtList($event, innerIndex)"
          >
            <i class="far fa-trash-alt"></i>
          </div>
          <div
            *ngIf="!isUnclonable(extItem.type)"
            class="form-ext-item__header-clone"
            (click)="cloneElementFromFormExtList($event, innerIndex, extItem)"
          >
            <i class="fa fa-copy"></i>
          </div>
          <div class="form-ext-item__header-collapse form-ext-item__header-collapse-opened" (click)="toggleItem($event, innerIndex)">
            <i class="fa fa-angle-up"></i>
          </div>
          <div class="form-ext-item__header-collapse form-ext-item__header-collapse-closed" (click)="toggleItem($event, innerIndex)">
            <i class="fa fa-pencil"></i>
          </div>
        </div>
      </div>
      <div class="form-ext-item__body">
        <div *ngIf="extItem.type === 'email'">
          <app-extended-email [item]="extItem" [index]="innerIndex"></app-extended-email>
        </div>
        <div *ngIf="extItem.type === 'name'">
          <app-extended-name [item]="extItem" [index]="innerIndex"></app-extended-name>
        </div>
        <div *ngIf="extItem.type === 'message'">
          <app-extended-message [item]="extItem" [index]="innerIndex"></app-extended-message>
        </div>
        <div *ngIf="extItem.type === 'phone'">
          <app-extended-phone [item]="extItem" [index]="innerIndex"></app-extended-phone>
        </div>
        <div *ngIf="extItem.type === 'text'">
          <app-extended-text [item]="extItem" [index]="innerIndex"></app-extended-text>
        </div>
        <div *ngIf="extItem.type === 'rating'">
          <app-extended-rating [item]="extItem" [index]="innerIndex"></app-extended-rating>
        </div>
        <div *ngIf="extItem.type === 'variants'">
          <app-extended-variants [item]="extItem" [index]="innerIndex"></app-extended-variants>
        </div>
        <div *ngIf="extItem.type === 'dd'">
          <app-extended-dd [item]="extItem" [index]="innerIndex"></app-extended-dd>
        </div>
        <div *ngIf="extItem.type === 'date'">
          <app-extended-date [item]="extItem" [index]="innerIndex"></app-extended-date>
        </div>
        <div *ngIf="extItem.type === 'title'">
          <app-extended-title [item]="extItem" [index]="innerIndex"></app-extended-title>
        </div>
        <div *ngIf="extItem.type === 'term'">
          <app-extended-term [item]="extItem" [index]="innerIndex"></app-extended-term>
        </div>
        <div *ngIf="extItem.type === 'button'">
          <app-extended-button [item]="extItem" [containerId]="widget.containerId" [index]="innerIndex"></app-extended-button>
        </div>
        <div *ngIf="extItem.type === 'hidden'">
          <app-extended-hidden [item]="extItem" [index]="innerIndex"></app-extended-hidden>
        </div>
      </div>
    </li>
  </ul>

  <div class="add-form-ext-new-item mr-3 border-item">
    <button class="btn-default widget-content-add-btn" (click)="addItemToExtForm(); $event.stopPropagation();">
      <i class="fa fa-plus"></i>{{ 'widgets.formExt.addAnotherElementToForm' | translate }}
    </button>
  </div>

  <!-- FORM ORIENTATION SETTINGS -->
  <div class="mt-3 border-item">
    <h3>Вид формы</h3>

    <div class="d-flex align-items-center justify-content-between mt-3">
      <label class="control-label control-label-des">Ширина</label>
      <div class="d-flex align-items-center">
        <div
          class="form-control form-control-font mr-2"
          [class.disabled]="widget.guiprops.formExt.model.mainSettings.form_width_type.label !== availMainWidthTypes[1].label"
        >
          <input
            type="number"
            [(ngModel)]="widget.guiprops.formExt.model.mainSettings.form_widthpx"
            [disabled]="widget.guiprops.formExt.model.mainSettings.form_width_type.label !== availMainWidthTypes[1].label"
          />
          <label>px</label>
        </div>
        <button
          class="wide-button"
          [class.active]="widget.guiprops.formExt.model.mainSettings.form_width_type.label === availMainWidthTypes[0].label"
          (click)="widget.guiprops.formExt.model.mainSettings.form_width_type = (widget.guiprops.formExt.model.mainSettings.form_width_type.label === availMainWidthTypes[0].label ? availMainWidthTypes[1] : availMainWidthTypes[0])"
        >
        </button>
      </div>
    </div>

    <div class="d-flex justify-content-between row-subitem row-subitem-padding mt-3">
      <label
        class="control-label control-label-des"
        [class.disabled]="widget.guiprops.formExt.model.mainSettings.form_width_type.label === availMainWidthTypes[0].label"
      >
        Выравнивание
      </label>
      <div>
        <button
          class="align-button icon-left"
          [class.active]="widget.guiprops.formExt.model.mainSettings.form_width_orientation_type.label === availMainWidthOrientationTypes[0].label"
          (click)="widget.guiprops.formExt.model.mainSettings.form_width_orientation_type = availMainWidthOrientationTypes[0]"
          [disabled]="widget.guiprops.formExt.model.mainSettings.form_width_type.label === availMainWidthTypes[0].label"
        ></button>
        <button
          class="align-button icon-center"
          [class.active]="widget.guiprops.formExt.model.mainSettings.form_width_orientation_type.label === availMainWidthOrientationTypes[1].label"
          (click)="widget.guiprops.formExt.model.mainSettings.form_width_orientation_type = availMainWidthOrientationTypes[1]"
          [disabled]="widget.guiprops.formExt.model.mainSettings.form_width_type.label === availMainWidthTypes[0].label"
        ></button>
        <button
          class="align-button icon-right"
          [class.active]="widget.guiprops.formExt.model.mainSettings.form_width_orientation_type.label === availMainWidthOrientationTypes[2].label"
          (click)="widget.guiprops.formExt.model.mainSettings.form_width_orientation_type = availMainWidthOrientationTypes[2]"
          [disabled]="widget.guiprops.formExt.model.mainSettings.form_width_type.label === availMainWidthTypes[0].label"
        ></button>
      </div>
    </div>
  </div>
  <!-- END FORM ORIENTATION SETTINGS -->

  <!-- GENERAL (MAIN) FORM SETTINGS -->
  <h3 class="mt-3">{{ 'widgets.formExt.mainSettings.visualField' | translate }}</h3>

  <div class="row-subitem w-100">
    <div class="dropdown mt-2">
      <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true">
        {{ widget.guiprops.formExt.model.mainSettings.visual.label }}
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li
          role="presentation"
          *ngFor="let itemVisual of visualTypesOfField"
          (click)="widget.guiprops.formExt.model.mainSettings.visual = itemVisual"
        >
          <a role="menuitem" tabindex="-1" href="javascript:void(0)" class="dropdown-item">{{ itemVisual.label }}</a>
        </li>
      </ul>
    </div>
  </div>

  <div class="d-flex justify-content-between row-subitem row-subitem-padding mt-3 pt-1">
    <label class="control-label control-label-des">
      {{ 'widgets.formExt.mainSettings.formField.orientation' | translate }}
    </label>
    <div>
      <button
        class="align-button icon-left"
        [class.active]="widget.guiprops.formExt.model.mainSettings.orientation.label === orientationTypesOfField[0].label"
        (click)="widget.guiprops.formExt.model.mainSettings.orientation = orientationTypesOfField[0]"
      ></button>
      <button
        class="align-button icon-center"
        [class.active]="widget.guiprops.formExt.model.mainSettings.orientation.label === orientationTypesOfField[1].label"
        (click)="widget.guiprops.formExt.model.mainSettings.orientation = orientationTypesOfField[1]"
      ></button>
      <button
        class="align-button icon-right"
        [class.active]="widget.guiprops.formExt.model.mainSettings.orientation.label === orientationTypesOfField[2].label"
        (click)="widget.guiprops.formExt.model.mainSettings.orientation = orientationTypesOfField[2]"
      ></button>
    </div>
  </div>

  <ng-container *ngIf="widget.guiprops?.formExt?.model">
    <div *ngIf="isFieldSettings()">
      <div class="row row-subitem mt-2 mb-2">
        <div class="col-sm-5 row-subitem-padding pt-1 mr-3">
          <label class="control-label control-label-colorpc control-label-des">{{ 'widgets.formExt.mainSettings.colorNameField' | translate }}:</label>
          <input
            [(colorPicker)]="widget.guiprops.formExt.model.mainSettings.colorTitleInputForm"
            [style.background]="widget.guiprops.formExt.model.mainSettings.colorTitleInputForm"
            [cpAlphaChannel]="'disabled'"
            [cpOutputFormat]="'hex'"
            class="w-100"
          />
        </div>

        <div class="col-sm-6 row-subitem-padding pt-1">
          <label class="control-label control-label-colorpc control-label-des">{{ 'widgets.formExt.mainSettings.colorBGField' | translate }}:</label>
          <input
            [(colorPicker)]="widget.guiprops.formExt.model.mainSettings.bgInputForm"
            [style.background]="widget.guiprops.formExt.model.mainSettings.bgInputForm"
            [cpAlphaChannel]="'disabled'"
            [cpOutputFormat]="'hex'"
            cpPosition="top"
            class="w-100"
          />
        </div>
      </div>
      <div class="row row-subitem mt-2">
        <div class="col-sm-12 row-subitem-padding pt-1 side-ui-sm">
          <ngx-slider [(value)]="widget.guiprops.formExt.model.mainSettings.opacityBgInputForm" [options]="optionsOpacity"></ngx-slider>
          <label class="control-label control-label-ui ml-2">{{ 'widgets.formExt.mainSettings.opacityBGField' | translate }}</label>
        </div>
      </div>
      <div class="row row-subitem mt-2 mb-3">
        <div class="col-sm-12 row-subitem-padding pt-1 side-ui-sm">
          <ngx-slider [(value)]="widget.guiprops.formExt.model.mainSettings.borderRadiusInputForm" [options]="optionsRound"></ngx-slider>
          <label class="control-label control-label-ui ml-2">{{ 'widgets.formExt.mainSettings.radiusCornerField' | translate }}</label>
        </div>
      </div>

      <div class="row row-subitem mt-2">
        <div class="col-sm-12 row-subitem-padding pt-1 d-flex">
          <ui-switch
            size="small"
            [(ngModel)]="widget.guiprops.formExt.model.mainSettings.border.enable"
          ></ui-switch><label class="control-label switcher-label-xs control-label-des mt-1 ml-2">{{ 'widgets.formExt.mainSettings.useBorderAroundFields' | translate }}</label>
        </div>
      </div>
      <div *ngIf="widget.guiprops.formExt.model.mainSettings.border.enable == true">
        <div class="row row-subitem">
          <div class="col-sm-6 row-subitem-padding pt-1">
            <label class="control-label control-label-colorpc control-label-des">{{ 'widgets.formExt.mainSettings.colorBorder' | translate }}:</label>
            <input
              [(colorPicker)]="widget.guiprops.formExt.model.mainSettings.border.color"
              [style.background]="widget.guiprops.formExt.model.mainSettings.border.color"
              [cpAlphaChannel]="'disabled'"
              [cpOutputFormat]="'hex'"
            />
          </div>
        </div>
      </div>
    </div>
  </ng-container>



  <div class="row row-subitem mt-2">
    <div class="col-sm-12 row-subitem-padding pt-1 d-flex">
      <ui-switch
        size="small"
        [(ngModel)]="widget.guiprops.formExt.model.mainSettings.colorPod.enable"
      ></ui-switch><label class="control-label switcher-label-xs control-label-des mt-1 ml-2">{{ 'widgets.formExt.mainSettings.usePodBG.title' | translate }}</label>
    </div>
  </div>
  <div *ngIf="widget.guiprops.formExt.model.mainSettings.colorPod.enable">
    <div class="row row-subitem">
      <div class="col-sm-6 row-subitem-padding pt-1">
        <label class="control-label control-label-colorpc control-label-des">
          {{ 'widgets.formExt.mainSettings.usePodBG.color' | translate }}:
        </label>
        <input
          [(colorPicker)]="widget.guiprops.formExt.model.mainSettings.colorPod.color"
          [style.background]="widget.guiprops.formExt.model.mainSettings.colorPod.color"
          [cpAlphaChannel]="'disabled'"
          [cpOutputFormat]="'hex'"
        />
      </div>
      <div class="col-sm-6 row-subitem-padding pt-1 side-ui-dev">
        <label class="control-label control-label-colorpc control-label-des">
          {{ 'widgets.formExt.mainSettings.usePodBG.opacity' | translate }}:
        </label>
        <ngx-slider [(value)]="widget.guiprops.formExt.model.mainSettings.colorPod.opacityColorPod" [options]="optionsOpacity"></ngx-slider>
      </div>
    </div>
  </div>
  <!-- END GENERAL (MAIN) FORM SETTINGS -->

  <!-- Coupon settings -->
  <app-coupon-callback
    [coupons]="coupons"
    [coupon]="widget.guiprops.formExt.couponCallback"
    [placePopup]="placePopup"
  ></app-coupon-callback>
</div>
